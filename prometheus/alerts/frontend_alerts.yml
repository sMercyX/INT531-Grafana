groups:
  - name: frontend_slo_alerts
    interval: 30s
    rules:
      # =========================================================
      # Availability
      # =========================================================
      - alert: FrontendServiceDown
        expr: up{job="frontend_service"} == 0
        for: 1m
        labels:
          severity: critical
          service: frontend
          signal: availability
        annotations:
          summary: "Frontend service is down"
          description: |
            Frontend service is not responding to health checks (up == 0).
            Users may be unable to access the application.
          runbook_url: https://github.com/sMercyX/INT531-Grafana/blob/main/prometheus/runbooks/frontend.md


      # =========================================================
      # Errors
      # =========================================================
      - alert: FrontendHighErrorRate
        expr: |
          (
            sum(rate(http_requests_total{job="frontend_service", status=~"5.."}[5m]))
            /
            sum(rate(http_requests_total{job="frontend_service"}[5m]))
          ) > 0.01
        for: 2m
        labels:
          severity: critical
          service: frontend
          signal: errors
        annotations:
          summary: "Frontend high error rate detected"
          description: |
            Frontend 5xx error rate exceeded SLO threshold (1%) for 2 minutes.
            This may be caused by backend API failures or a broken frontend deployment.
          runbook_url: https://github.com/sMercyX/INT531-Grafana/blob/main/prometheus/runbooks/frontend.md


      # =========================================================
      # Latency
      # =========================================================
      - alert: FrontendHighLatency
        expr: |
          histogram_quantile(0.95,
            sum(rate(http_request_duration_seconds_bucket{job="frontend_service"}[5m])) by (le)
          ) > 0.5
        for: 3m
        labels:
          severity: warning
          service: frontend
          signal: latency
        annotations:
          summary: "Frontend high latency detected (P95)"
          description: |
            Frontend P95 latency exceeded 0.5s for 3 minutes.
            User experience may be degraded.
          runbook_url: https://github.com/sMercyX/INT531-Grafana/blob/main/prometheus/runbooks/frontend.md


      # =========================================================
      # Error Budget (Runbook-defined)
      # =========================================================
      - alert: FrontendErrorBudgetBurn
        expr: |
          (
            (
              sum(rate(http_requests_total{job="frontend_service", status=~"5.."}[5m]))
              /
              sum(rate(http_requests_total{job="frontend_service"}[5m]))
            ) > 0.01
          )
          OR
          (up{job="frontend_service"} == 0)
        for: 5m
        labels:
          severity: critical
          service: frontend
          signal: error_budget
        annotations:
          summary: "Frontend error budget burn is high (proxy)"
          description: |
            Frontend is either down or sustaining 5xx error rate above 1% for 5 minutes.
            Treat as rapid error budget burn and prioritize reliability actions.
          runbook_url: https://github.com/sMercyX/INT531-Grafana/blob/main/runbooks/frontend-golden-signals.md
